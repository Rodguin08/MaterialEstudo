{"ast":null,"code":"'use strict';\n/**\n * `password` type prompt\n */\n\nconst chalk = require('chalk');\n\nconst {\n  map,\n  takeUntil\n} = require('rxjs/operators');\n\nconst Base = require('./base');\n\nconst observe = require('../utils/events');\n\nfunction mask(input, maskChar) {\n  input = String(input);\n  maskChar = typeof maskChar === 'string' ? maskChar : '*';\n\n  if (input.length === 0) {\n    return '';\n  }\n\n  return new Array(input.length + 1).join(maskChar);\n}\n\nclass PasswordPrompt extends Base {\n  /**\n   * Start the Inquiry session\n   * @param  {Function} cb      Callback when prompt is done\n   * @return {this}\n   */\n  _run(cb) {\n    this.done = cb;\n    const events = observe(this.rl); // Once user confirm (enter key)\n\n    const submit = events.line.pipe(map(this.filterInput.bind(this)));\n    const validation = this.handleSubmitEvents(submit);\n    validation.success.forEach(this.onEnd.bind(this));\n    validation.error.forEach(this.onError.bind(this));\n    events.keypress.pipe(takeUntil(validation.success)).forEach(this.onKeypress.bind(this)); // Init\n\n    this.render();\n    return this;\n  }\n  /**\n   * Render the prompt to screen\n   * @return {PasswordPrompt} self\n   */\n\n\n  render(error) {\n    let message = this.getQuestion();\n    let bottomContent = '';\n\n    if (this.status === 'answered') {\n      message += this.getMaskedValue(this.answer);\n    } else {\n      message += this.getMaskedValue(this.rl.line || '');\n    }\n\n    if (error) {\n      bottomContent = '\\n' + chalk.red('>> ') + error;\n    }\n\n    this.screen.render(message, bottomContent);\n  }\n\n  getMaskedValue(value) {\n    if (this.status === 'answered') {\n      return this.opt.mask ? chalk.cyan(mask(value, this.opt.mask)) : chalk.italic.dim('[hidden]');\n    }\n\n    return this.opt.mask ? mask(value, this.opt.mask) : chalk.italic.dim('[input is hidden] ');\n  }\n  /**\n   * Mask value during async filter/validation.\n   */\n\n\n  getSpinningValue(value) {\n    return this.getMaskedValue(value);\n  }\n  /**\n   * When user press `enter` key\n   */\n\n\n  filterInput(input) {\n    if (!input) {\n      return this.opt.default == null ? '' : this.opt.default;\n    }\n\n    return input;\n  }\n\n  onEnd(state) {\n    this.status = 'answered';\n    this.answer = state.value; // Re-render prompt\n\n    this.render();\n    this.screen.done();\n    this.done(state.value);\n  }\n\n  onError(state) {\n    this.render(state.isValid);\n  }\n\n  onKeypress() {\n    // If user press a key, just clear the default value\n    if (this.opt.default) {\n      this.opt.default = undefined;\n    }\n\n    this.render();\n  }\n\n}\n\nmodule.exports = PasswordPrompt;","map":null,"metadata":{},"sourceType":"script"}