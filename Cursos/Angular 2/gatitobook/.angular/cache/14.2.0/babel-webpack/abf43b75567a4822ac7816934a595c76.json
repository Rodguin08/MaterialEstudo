{"ast":null,"code":"// pass in a manifest with a 'bin' field here, and it'll turn it\n// into a properly santized bin object\nconst {\n  join,\n  basename\n} = require('path');\n\nconst normalize = pkg => !pkg.bin ? removeBin(pkg) : typeof pkg.bin === 'string' ? normalizeString(pkg) : Array.isArray(pkg.bin) ? normalizeArray(pkg) : typeof pkg.bin === 'object' ? normalizeObject(pkg) : removeBin(pkg);\n\nconst normalizeString = pkg => {\n  if (!pkg.name) {\n    return removeBin(pkg);\n  }\n\n  pkg.bin = {\n    [pkg.name]: pkg.bin\n  };\n  return normalizeObject(pkg);\n};\n\nconst normalizeArray = pkg => {\n  pkg.bin = pkg.bin.reduce((acc, k) => {\n    acc[basename(k)] = k;\n    return acc;\n  }, {});\n  return normalizeObject(pkg);\n};\n\nconst removeBin = pkg => {\n  delete pkg.bin;\n  return pkg;\n};\n\nconst normalizeObject = pkg => {\n  const orig = pkg.bin;\n  const clean = {};\n  let hasBins = false;\n  Object.keys(orig).forEach(binKey => {\n    const base = join('/', basename(binKey.replace(/\\\\|:/g, '/'))).slice(1);\n\n    if (typeof orig[binKey] !== 'string' || !base) {\n      return;\n    }\n\n    const binTarget = join('/', orig[binKey]).replace(/\\\\/g, '/').slice(1);\n\n    if (!binTarget) {\n      return;\n    }\n\n    clean[base] = binTarget;\n    hasBins = true;\n  });\n\n  if (hasBins) {\n    pkg.bin = clean;\n  } else {\n    delete pkg.bin;\n  }\n\n  return pkg;\n};\n\nmodule.exports = normalize;","map":null,"metadata":{},"sourceType":"script"}